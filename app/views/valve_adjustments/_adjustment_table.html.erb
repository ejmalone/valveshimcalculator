<table>
  <tr><td>Intake </td><td><%= @engine.intake_min %> - <%= @engine.intake_max %></td></tr>
  <tr><td>Exhaust </td><td><%= @engine.exhaust_min %> - <%= @engine.exhaust_max %></td></tr>

  <% @engine.cylinders.each_with_index do |cylinder, cyl_index| %>
    <tr>
      <td colspan="4">Cylinder <%= cyl_index %></td>
    </tr>
    <tr>
      <th>Valve name</th>
      <% if user_session["debug"] %>
        <th>Valve ID</th>
      <% end %>
      <th>Current gap</th>
      <th>Current shim</th>
      <% if user_session["debug"] %>
        <th>Shim ID</th>
      <% end %>
      <th>New shim (thinner is better)</th>
      <th>Using new shim</th>
    </tr>
    <% cylinder.valves.each do |valve| %>
      <tr valve-id="<%= valve.id %>">
        <td style="color: <%= valve_shim_calculator.valve_style(valve) %>"><%= label_tag valve_form_label(valve) %></td>
        <% if user_session["debug"] %>
          <td><%= valve.id %></td>
        <% end %>
        <td><%= valve.gap %></td>
        <td><%= valve.shim.thickness %></td>
        <% if user_session["debug"] %>
          <td><%= valve.shim.id %></td>
        <% end %>
        <td><%= valve.gap.present? ? valve_shim_calculator.new_shim_thickness_range(valve) : '-' %></td>
        <% shim = params[:choose_shims] ? valve_shim_calculator.new_shim(valve) : valve.shim %>

        <% if shim %>
          <td style="color: <%= valve_shim_calculator.shim_style(valve, shim) %>">
            <%= shim.thickness %>
            <% if user_session["debug"] %>
              - <%= shim.id %>
            <% end %>
          </td>
        <% end %>
      </tr>
    <% end %>
  <% end %>
</table>